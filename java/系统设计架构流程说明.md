# 系统设计思路
  题目要求是：
>   1.长链接可以置换成短链接 2.短链接可以置换成原始的长链接

### 思考流程
##### 首先要考虑的是，一个长链接如何转换成一个短链接？长变短肯定需要有一个对应的转换机制。最初能想到就是对长链接进行hash或者类似base64的进制转换，来让一个长字符串变成一个短字符串。

##### hash方式会有冲突，我们需要用简单的方式来实现，所以选用base64进制转换方式。但一个原始的url长链接字符长度不固定，转换之后的长度不可控，题目的要求是生成的短连接最长为8位。所以不能直接使用原始url转换。

##### 针对以上的问题，我们做一个发号器，每一个url对应一个唯一号码，然后对号码做base62的转换，变成最长8位的短码。

### 长链接转换短连接设计实现
- 对入口的方法的url做合法性校验
- 设置一个长链接和短连接的映射map，先查询长链接在map中是否存在
- 如果存在，从map查询到value，返回结果
- 如果不存在，先调用发号器，生成一个新号码，进行base62转换得到一个短链接码
- 再将长链接和短链码组成映射放入linkMap（长链接和短链码的映射），以及放入idMap（短链码和长链接的映射）
- 整个过程中，防止出现线程不安全的情况，进行加锁控制

### 短链接转换长链接的设计实现
- 对入口的方法的url进行校验，是否符合短链接要求
- 在idMap中判断此短链接码是否存在
- 不存在直接返回空；存在则在idMap获取对应的长链接再返回

### 设计图
1. 长链接转短链接
![长链接转短链接](https://note.youdao.com/yws/public/resource/99c7cea79c2b77aedc326be052478952/FB68E5DC567C4DCE9541957B85A2F2C7?ynotemdtimestamp=1660040198241)

2. 短链接转长链接
![短连接转长链接](https://note.youdao.com/yws/public/resource/99c7cea79c2b77aedc326be052478952/3EE9351E0E6D4FC3BB39351F0DABD004?ynotemdtimestamp=1660040198241)

# 单元测试的jacoco覆盖率
![覆盖率](https://note.youdao.com/yws/public/resource/99c7cea79c2b77aedc326be052478952/14E82EFBFCBE4D878604C81B78AFAB33?ynotemdtimestamp=1660040198241)

# demo设计的一些缺陷
1. 目前整个demo是单机模式，利用锁，并发度不是很高。
2. 由于是设计8位短链接码，我们使用long的数字来发id，可能会出现超过溢出，抛出异常。

# 改进方向
1. 发号器可以做成集群版，使用redis或者数据库来发号，并发度会高一些。
2. 8位的短链接码是由于使用base62的方式来实现所以有长度限制，这个数据量大小可支持一般系统，不需要做特殊优化。
