#假设
根据需求限制：映射数据存储在JVM内存即可，可以做出如下假设
- 数据存储在JVM内存，内存数据掉电即消失，设计时不考虑映射数据的持久化与启动加载，只针对实时场景
- 42亿的长链接映射容量满足项目需求

# 设计思路
短链接生成采用MurmurHash算法生成hash值，然后进行64位字符编码。考虑到hash冲突，当检测到hash冲突时，
可在原串基础上拼接自定义字段，再次生成hash。由于MurmurHash该算法具有很好的散列性质，这种重试次数会
很低。

考虑到读取性能和高并发下的线程安全,映射关系采用ConcurrentHashMap数据结构。设计两个hashmap,一个用于
短链接解析为长链接，一个用于长链接重复生成检测。

采用32位的hashcode数据范围为[1,2^32-1],然后采用64位字符编码，编码长度为1-6位，满足短域名编码最长
为8字符要求。

## 存数据接口
1. 检测hashmap key中是否存在待转换的长链，若存在，直接返回对应的短链接。
2. 将长链接（longUrl）经过 32bit MurmurHash算法运算后得到hashcode
3. 对hashcode 64进制编码得到短链接字符串
4. 将短链接去映射表中查找看是否存在相关记录，如果不存在，将长链与短链对应关系插入到map中存储。如果存在，
说明已经有相关记录了，发生hash冲突，此时在长链接上拼接一个自定义字段，比如**NULLDUPLICATENULL**，然后
再对拼接的字段串做第2步操作，如果最后还是重复，再拼一个字段串直到不冲突，最后存储映射关系到map中。

## 取数据接口
检测map key中是否有该短链，没有则抛异常，提示短链接不存在。有则取出长链，然后去除自定义字段，最后返回。


#Jacoco测试报告
项目采用Junit进行单元测试，并使用Jacoco工具生成测试报告。指令覆盖率99%和分支覆盖率100%。
![Jacoco测试报告](../images/jacoco%20report.png)

#延展材料
```
MurmurHash 是一种非加密型哈希函数，适用于一般的哈希检索操作。由Austin Appleby在2008年发明，并出现了
多个变种，都已经发布到了公有领域(public domain)。与其它流行的哈希函数相比，对于规律性较强的key，
MurmurHash的随机分布特征表现更良好。

特点
1.快。
MurMurHash3 比 MD5 快。

2.低碰撞。
MurMurHash3 128 位版本哈希值是 128 位的，跟 MD5 一样。128 位的哈希值，在数据量只有千万级别的情况下，基本不用担心碰撞。

3.高混淆。
散列值比较“均匀”，如果用于哈希表，布隆过滤器等, 元素就会均匀分布。

```


