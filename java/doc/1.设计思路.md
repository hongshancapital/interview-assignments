# 设计思路
***
## 关键点：短码&URL

短码：

- 要求8位以内，常见的10进制，16进制容量太小。因此考虑以URL中的语义字符0~9,A-Z,a-z共62个字符编码为62进制串
- 62进制短码使用字符表达，8位62进制转为10进制为218340105584895，在Long类型最大值范围以内，可以用数值类型表达，较为省空间，且索引性能较好。
- 常用的ID生成策略主要有增长类（如：自增长，雪花算法），随机类：（如：UUID，随机数），摘要类（如：hashCode，MD5）
  - 增长最为常用，但是如果没有存储支持，应用重启/时钟回拨会导致增长序列混乱
  - 随机存在碰撞的可能，因此需要考虑碰撞校验，发生碰撞时重新随机再试
  - 摘要算法较为稳定，但是如果发生碰撞，就只能加入随机数重新摘要，也演变成随机
> 性能：增长类占优势，无复杂运算；随机类引入随机生成器，需检验碰撞，重新生成；摘要类引入摘要算法，需检查碰撞，还可能依赖随机  
> 安全：自增长可预测，安全性较差；雪花算法单调增长，相对松散；随机及摘要的随机性较强，最为安全  
> 稳定：自增长需维护最大值；雪花算法需确保逻辑上时钟不回拨；随机及摘要随着量的增大发生碰撞的几率增高  
> 空间：自增长最优；雪花算法如果生成频次不高存在严重的浪费；随机及摘要存在随机性  
> 根据以上分析，考虑实现自增长，雪花算法，随机数三种方案，根据业务要求选择。  
>
> 其中雪花算法ID在低频情况下利用率不高。且因为长度限制，常规的参数配置生成的ID超出范围，需要根据实际场景进行调整。   
> 根据期望使用时间长度调整时间位长度；根据部署架构减少datacenterId及workerId位数；根据实际生成频次降低时间位精度或者sequence位数。

URL：

- URL通常字符数量不大，因此考虑原样存储。如果场景是超长URL，可考虑压缩存储。

关系：

- 映射关系要求存储于内存，但要防止内存溢出。内存大小有限，要防止内存溢出，只能允许部分重要性低的数据丢失。
- 短链接常用于短信或微博媒体等文本字数有限制的场景使用，这种场景下锻炼产生的时间越早，被访问的几率及价值就越低。
> JVM的软引用机制在内存不足时，按引用最后访问时间优先回收最久无访问的，与当前需求较为匹配。  
> 成熟的Java缓存组件Caffeine在性能，并发安全及弱引用管理各方面都符合需求，可选用Caffeine作为映射关系的存储，限制最大存储条数，URL值使用弱引用。
