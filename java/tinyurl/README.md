# 说明

## 短连接的使用场景
例如Twitter、微博的用户在发送内容中如果包含有链接，会将链接进行过滤转换，并生成一个短链接与原始链接一一映射。当用户访问短连接时会被重定向到原始链接中。这样做的目的是：缩短twitter、微博内容的长度，较短的链接可以降低用户输入错误的概率，另外，通过短连接的过滤，可以增加对原始链接访问的统计分析等。

## 短连接服务的目标
-  输入一个链接，生成一个唯一的、长度不超过8个字符的短连接【短域名长度最大为 8 个字符】短链接不超过8个字符，如果域名格式为 t.co，那么短连接保留3位字符长度，使用大小写加数字定义，则最多可以保存：62 ^ 3 = 238328个短连接。
- 如果域名不计入长度，那么短连接使用8位字符长度，则最多可以保存：62 ^ 8 个短连接。
-  输入短域名，重定向跳转到原始URL页面中。

## 系统容量预估
tinyurl系统是read-heavy的系统.<br>
- 假设读写比以100:1为例，如果我们写入新url速度为200/s，那么短链接重定向的速率为 20000/s，<br>
- 假设原始链接的长度为500B，那么写入速率为 200/s * 500B = 100KB/s， 读取速率为 100 * 100KB/s = 10MB/s，<br>
- 假设我们每一个链接存储的有效期为5年，那么我们需要存储的总链接个数为 200/s * 3600s * 24 * 365 * 5 约为 30Billion个url，存储这些url需要使用存储空间为 500B * 30Billion = 15TB。<br>

## 短连接生成方式
-  对url进行编码，解决冲突可以在url中追加变量实现，通过改变原始 url地址来解决冲突。
-  使用唯一ID标记原始url地址，再将ID转换为62进制的短连接。ID生成器有多种实现方式，当前使用的是定义原子变量实现，也可以使用美团分布式ID生成服务实现满足高并发要求。

## 短连接服务延伸问题
-  系统应该是高可用的。如果我们的服务关闭，所有 URL 重定向都将失败，增加负载均衡策略。
-  缩短的链接不可预测。通过尝试 Twitter 服务和 Weibo 服务提供的短连接，Twitter服务短连接不可预测，Weibo服务的短连接可以预测。通过打乱 [a-z,A-Z,0-9] 的顺序，可以初步实现不可预测的功能。
-  防止恶意访问。可以通过对记录请求IP地址来限制同一IP的访问次数。
-  可以通过记录更多信息来跟踪统计访问数据。

