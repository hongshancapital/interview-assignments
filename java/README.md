#核心需求
1. 长域名转换为短域名
2. 短域名转换回长域名
3. 短域名要求8个字符以内

#关键点设计
##长域名转换短域名
###方案一：MD5
1. 将长域名经过MD5加密之后之后获取16个字节的加密串，转换为32位的16进制字符
2. 将32位的加密串按8位一组分为四组
3. 判断四组中是否未使用过的短域名，如有则直接使用，如没有则随机生成一个，不断重试直到没有发生碰撞

###方案二：自增ID模式
1. 根据长域名获取短域名时发放一个自增编号，保证不重复
2. 将该自增编号转换为62进制字符，8位62进制字符在TPS为100的情况下可以使用69235 年，足够使用
3. 为避免生成的字符串有规律可循，将62进制字符打散 01hjkl249aops5bn7dfgqwerty3ui6zx8cvm

两个方案对比方案二实现更简单且能满足当前需求，使用方案二

##数据结构设计
LinkedHashMap<String, String> long2ShortMap;
LinkedHashMap<String, String> short2LongMap;
大小上限固定，达到上限之后使用LRU淘汰数据

##整体架构设计
![img.png](img.png)

当前功能比较简单，但是要留好扩展点，遵循OCP和稳定依赖的架构守则。
主要扩展点：
1. 数据目前保存在内存，后续可能会保存在数据库或者Redis，架构中设计好接口后续方便扩展
2. 短域名生成策略使用策略模式，后续有需要变更时可直接添加新策略不需要修改已有代码(本期未扩展)

##数据正确性保证
1. 自增id使用LongAdder保证线程安全
2. 域名映射的保存、长度的检查加锁

#测试报告
##代码覆盖率
![img_1.png](img_1.png)
##性能测试方案
1. 将测试机器和服务部署机器分离
2. 真正压测之前先跑1K条请求进行预热
3. 跑5W条请求，依次使用30、50、100、150个并发压测查看qps和耗时趋势
4. 得到预期的qps和平均耗时即为单机qps
5. 为了更好模拟线上真实环境每次请求最好使用不同的参数

为了简单测试客户端和服务都在本机，使用ab压测：
脚本：ab -n 15000 -c 50 -k http://localhost:8080/shortUrl?longUrl=http%3A%2F%2Fwww.baidu.com%2Fhahaheihei%2Fheh%2Flele

单机压测结果：
![img_2.png](img_2.png)
qps 12473 , 平均耗时4ms
