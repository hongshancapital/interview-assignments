# Java Assignment

## 这是什么？

为了节省大家的时间，我们使用作业分配来对Java候选人进行资格预审。这使我们在面试中保持客观，专注于候选人解决​​复杂问题并捍卫他们选择技术或方法的能力。我们还评估候选人如何处理来自同事、管理层或运营团队的压力，时间压力，批评和审查。

***要考虑参加面试，您需要完成下面的“作业”部分。***

### Assignment

> **Tips: 记得注意仔细审题**

#### 实现短域名服务（细节可以百度/谷歌）

撰写两个 API 接口:
- 短域名存储接口：接受长域名信息，返回短域名信息
- 短域名读取接口：接受短域名信息，返回长域名信息。

限制：
- 短域名长度最大为 8 个字符
- 采用SpringBoot，集成Swagger API文档；
- JUnit编写单元测试, 使用Jacoco生成测试报告(测试报告提交截图)；
- 映射数据存储在JVM内存即可，防止内存溢出；

**递交作业内容** 
- 源代码(按照生产级的要求编写整洁的代码，使用gitignore过滤掉非必要的提交文件，如class文件)
- Jacoco单元测试覆盖率截图(行覆盖率和分支覆盖率85%+)
- 文档：完整的设计思路、架构设计图以及所做的假设(Markdown格式)

**加分项** 
- 系统性能测试方案以及测试结果



## Job Description

### 岗位职责

1. 负责公司内部自用产品开发，能够独立的按产品需求进行技术方案设计和编码实现，确保安全、可扩展性、质量和性能;
2. 在负责的业务上有独立的见解和思考，对业务产品具有独立沟通、完善业务需求和识别方案风险的能力;
3. 具有持续优化、追求卓越的激情和能力，能持续关注和学习相关领域的知识，并能使用到工作当中;
4. 具备和第三方供应商进行沟通，对设计方案进行审核的能力;

### 要求

1. 5年软件研发/解决方案设计工作经验(金融领域经验加分)；
2. Java基础扎实，熟悉高级特性和类库、多线程编程以及常见框架(SpringBoot等)；
3. 具备基本系统架构能力，熟悉缓存、高可用等主流技术；
5. 持续保持技术激情，善于快速学习，注重代码质量，有良好的软件工程知识和编码规范意识；



## swagger地址
http://localhost:8080/swagger-ui/
## 单元测试覆盖率截图
写了并发的代码，单测不一定能够走到相应的分支，所以单测覆盖率略低。
在src/test/resources/report/jacoco-ut.png
## 设计思路
一. 首先需要实现的功能: 

- 短域名存储接口：接受长域名信息，返回短域名信息
- 短域名读取接口：接受短域名信息，返回长域名信息
- 短域名长度最大为 8 个字符

二. 设计思路

1.短域名生成规则

    短域名字符串使用0-9a-zA-Z总共62个字符，采用的随机生成的策略。把这62个字符组成一个字符串，
    使用java.util.Random随机数63，如果随机到62,取空字符串，否则取对应下标的字符。因为短域名
    限制最大长度为8，所以需要随机8次，组成一个短域名。随机数的可能性大于200万亿，所以基本上不
    需要考虑短域名的可用数量。

2.短域名存储接口：接受长域名信息，返回短域名信息

    接口接收一个长域名，返回短域名。使用两个HashMap存储数据，一个存储长域名到短域名的映射。另
    一个HashMap存储短域名到长域名的映射。在接口调用时，首先判断长域名是否已经有对应的短域名生成
    如果已经存在，就直接从Map中获取，不存在就生成新的短域名，并做数据存储，然后返回。

3.短域名读取接口：接受短域名信息，返回长域名信息

    从短域名-长域名Map中直接获取。

## 架构设计图

在src/test/resources/report/framework.png

## 假设

1.相同长域名多次调用存储接口

    这里维护了一个长域名到短域名的Map，多次调用会生成相同的短域名。

2.并发造成长域名多次存储、相同短域名多次使用

    在存储域名的时候加了可重入锁，做了长域名和短域名的判断。防止并发的情况。

3.服务器的性能 保存多少域名 数据存储空间

    随机短域名的数量200万亿足以使用。
    在存储上，1G内存，大概可以存储400万以上平均长度为30的不重复长域名(经过本地测试)
    所以在程序运行时，需要预算服务器内存能存储多少域名，给map最大长度限制。避免内存溢出
    
4.数据持久化

    可以开启定时任务定期备份数据到磁盘，在服务启动的时候加载磁盘数据。
    避免服务意外宕机，导致数据丢失。
    
5.服务高可用

    由于数据在存储在本地缓存中，所以服务做集群。后续可以改进用数据库或者Redis存储。

6.长、短域名输入校验
    
    只校验了长度
    看到网上有使用6-7位随机数加1-2校验值的短域名生成策略。这里没有使用校验值的原因是在这里
    这个校验没什么用。数据使用的是内存存储，直接从Map中读取数据就可以知道短域名是否有效，效率
    也不会慢。如果后续改用数据库存储，校验值并不能很好的解决数据有效性问题，因为校验位冲突可能
    性比较大。布隆过滤更合适一些。

7.为什么使用两个Map

    主要是多保存了一个长域名-短域名的映射。使长域名多次调用短域名存储接口，返回的都是一个短域名。
    这样就保证长域名的短域名一一对应，避免数据重复保存。

8.怎么样在短时间内产生大量的唯一标识ID？

    可以每次获取7位随机数，留一下位当做递增序列。这样每生成一次随机数就相当于生成了62个短域名。
    如果还是不满足要求，可以每次获取6位随机数留下两位递增序列，这样每次获取3600+个短域名。

9.删除短链接的策略？
    
    如果需要设置短域名过期删除策略，需要维护一个LRU的优先队列，可以使用PriorityQueue解决。
    实现Comparator接口，根据短域名生成时间、使用时间、使用次数等定义优先级。
    
