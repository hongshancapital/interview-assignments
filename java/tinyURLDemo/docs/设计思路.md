## 系统设计思路

1. 基于 spring-boot 的应用架构。
2. 基于 RESTful 风格的对外接口。
3. 暂时使用本机内存作为存储介质。
4. 现 demo 为单机应用，但需为之后扩展预留接口，目前考虑可能的两类：
    - 存储接口，变为多节点服务后 dao 层对数据库及 redis 等组件的操作接口。
    - 算法接口，替换不同的短链接映射算法。


## 系统架构设计

基于程序根目录各包说明：
- common：自定义通用组件。
    - exception：自定义异常处理。
    - result：请求响应对象。
    - utils：工具类。
- config：配置组件。基于 spring-boot 的配置类，如缓存配置类、swagger 配置类等。
- curURL：接收已生成短链接的请求，返回原始地址，及相关业务逻辑。短链接的生成及解析进行服务拆分后，以此为基础生成短链接解析服务，或进一步作为中间路由重定向跳转到原始地址。
    - controller：web 请求接收层。
    - dto：数据传输对象。
    - service：短连接解析服务层。
- dao：存储逻辑的接口及实现类，目前以内存为存储介质，预留数据库及缓存服务的实现接口，后续可向下调用 repository 数据仓库层。
- entity：短链接的实体对象。
- oriURL：接收原始地址，返回生成的短链接，及相关业务逻辑。短域名的生成及解析进行服务拆分后，以此为基础生成短链接生成服务。
    - controller：web 请求接收层。
    - dto：数据传输对象。
    - service：短连接生成服务层。
- strategy：短链接生成策略接口及实现类。


## 技术栈

1. 语言：Java，版本：1.8
2. 服务架构：spring-boot
3. 服务类型：web 应用
4. 存储组件：guava caffeine


## 缓存存储

短链接实体对象属性：
- id：int。4 字节。
- curURL：String，短链接地址。约为 40 + 2N，要求短链接自身长度不超过 8，加上假设前缀 https://t.cn/ 则不超过 21，预计 62 字节。
- oriURL：String，原链接地址。假设长度不超 256，预计 562 字节。
- createTimeStamp：long，创建时间戳。8 字节。

占用存储空间：
- 上述总共为 636 字节，考虑计算并不精确，预留一定冗余，再结合存储时的 key 值，考虑每个实体对象需要 1k 空间。
- 另，存储时需分别以短链接和原链接分别作为 key 存储一次，则每个实体占用空间为 2k。
- 假设限制用以存储的内存上限为 8G，则约可存储 4 百万个对象，存储数量上限暂定为此。


## 测试报告

- 覆盖率仅为 56%，分支覆盖率更低。
- 业务逻辑已基本覆盖。
- 未覆盖部分
    - 部分工具类，支撑项目使用，可能存在未用到的方法。
    - 自动生成的代码，lombok 注释生成的 equals() 方法等。
    - 保障系统健壮性的异常分支，难以测试。
    - 扩展用的接口及实现，已注释掉一部分。
- 整体情况请见 /docs/jacoco.png 截图。


## 待优化部分

1. 系统结构为单体应用，无法简单动态扩展，扩展后需搭配其他组件控制请求路由，以避免随机分发请求造成资源浪费。
2. 以自身内存为存储介质，在多节点后会出现地址映射混乱。
3. 考虑后续可能短域名解析的请求会相对较多，需要将读写请求服务分离，解析服务需考虑作为中转跳板的可能。
4. 算法来源于网络，未深入研究，可能存在风险。
5. 明细的自定义业务异常缺失。
6. 部分配置及常量属性待优化。
7. 对恶意请求的处理缺失。
8. 相同请求处理缺失，避免与现有的存储机制竞争资源，暂未添加。
9. 日志缺失。
10. 部分可扩展部分待优化，如相关枚举类，避免新增实现后都需要修改。


## 备注
- 个人目标意向为三亚的 java 岗位，与 hr 沟通后添加到武汉 java 的路径下，如投递错误请见谅。
- 未提供压测报告，个人未使用过相关组件，可能的话后续补充。
