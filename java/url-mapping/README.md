# 长短域名映射实现说明

配置文件中store.maxSize值对应项目最多保存的短域名个数



## 短域名表示

因为短域名有长度限制，而长域名长度无限制或者说长度比短域名长，那么理论上必然存在长域名无法映射到短域名的情况，即短域名全部用完；因此需要在程序中添加限制。
本项目短域名使用了long型递增计数器，输出时按照10进制到62进制转换，之所以采用long型递增计数器，主要处于两个原因：
- 效率高：递增分配不需要检测冲突，散列存在碰撞可能
- 递增分配，可用空间最大

## 短域名到长域名存储

url: POST /url_mapping/long2short  

根据上一章节，短域名是长整数，可以用一个大数组保存所有的域名，短域名执行62进制到10进制转换，转换出来的数字做游标即可。
实际中数组长度最大为int最大值，long值很可能超过int最大值，造成溢出，因此将数据分为多个数组存储。


可优化点（TODO）：
- 存储时可以将http://和https:// 压缩为0和1，进一步减少空间使用
- 对常用域名进行编码映射，降低空间使用

## 长域名到短域名存储

url: GET /url_mapping/short2long/{shorUrl}

基于域名前缀重复率高的特点，采取前缀树（Trie树）存储，能降低空间消耗，且查找速度优异。 
本项目使用了基数树（Patricia Trie），基数树更节省空间，支持插入、删除、查找操作。查找包括完全匹配、前缀匹配、前驱查找、后继查找。所有这些操作都是O(k)复杂度，其中k是所有字符串中最大的长度。  
本项目实际使用了commons-collections4包的PatriciaTrie

可优化点（TODO）：同上一章节







