## 压力测试

### （一）测试准备

#### 1.JVM配置

考虑到需要在JVM内存中存储大量链接数据，将最小堆内存设置到2GB

JVM内存分配：最大/最小堆内存为2048MB，Eden和Survivor比例为8:2，永久代初始化512MB，最大512MB。

JVM配置参数如下：

```
-XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:MaxTenuringThreshold=15 -XX:+ExplicitGCInvokesConcurrent -XX:+CMSParallelRemarkEnabled -Xmx2048m -Xms2048m -Xmn1024m -XX:NewSize=640m -XX:MaxNewSize=640m -XX:SurvivorRatio=8 -XX:PermSize=512m -XX:MaxPermSize=512m
```

#### 2.测试工具

使用Jmeter工具进行接口压测，使用jconsole工具监测应用



### （二）测试方案

考虑到当前系统方案，主要存在写并发竞争及真实情况下读多写少的真实场景，设计以下两个测试方案：

#### 1.长连接编码接口并发写入压力测试

(1)使用RandomString函数生成随机请求参数作为编码长连接请求

(2)配置10个线程并发访问10分钟，模拟写并发场景



#### 2.混合读写压力测试

(1)配置10个线程并发读，2个线程并发写，模拟读写并发场景

(2)长连接编码请求参数参照上述设置，短链接解码预置100个，随机选取



### （三）压测结果

#### 1.长连接编码接口并发写入压测结果如下：

10个线程并发不间断访问情况下

- 单机QPS稳定在**5000**以上，
- 长连接编码接口响应平均值和中位数均为**1ms**
- 应用cpu及线程数未出现大幅波动
- 应用内存占用随写入数据的增多主键上升，未出现写入异常情况

#### 2.混合读写压力测试压测结果如下：

10个线程并发读，2个线程并发写不间断访问情况下

- 总QPS稳定在**6000**以上，读QPS稳定在**5000**以上，写QPS稳定在**1000**以上
- 读接口响应平均值和中位数均为**1ms**，写接口响应平均值为**1ms**和中位数为**2ms**
- 应用cpu及线程数未出现大幅波动
- 应用内存占用随写入数据的增多主键上升，未出现写入异常情况

### （四）压测截图

#### 1.长连接编码接口并发写入压力测试截图

##### 配置请求参数如下：

![image-20220512113536375](.\Jmeter请求参数配置.jpg)

##### 配置并发访问如下：

![image-20220512113558805](.\并发参数配置.jpg)

##### 结果如下图所示：

![image-20220512114854952](.\聚合报告.jpg)

![image-20220512113945700](.\汇总报告.jpg)

##### jconsloe监控如下图所示

![image-20220512114107024](.\jconsole监控.jpg)

#### 2.混合读写压力测试截图

##### 短链接配置请求参数如下：

![image-20220512140355606](C:\Users\fxx\Desktop\压力测试\短链接线程配置.jpg)

##### 短链接并发线程配置如下：

![image-20220512140320893](.\短链接请求参数配置.jpg)

##### 读写测试-聚合报告

![image-20220512140218183](.\读写-聚合报告.jpg)

##### 读写混合-jconsole测试：

![image-20220512140422095](.\读写-jconsole监控)