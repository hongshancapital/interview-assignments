### 设计思路

1. **发号器**

   发号器需要持久化，选用了 mongodb。$inc 是原子操作，可以确保并发安全

2. **子序列**

   为了降低发号器的压力，采用发号器加本地子序列一起来生成序号，**序号** = 发号器序号\*子序列长度 + 当前子序列号。
   从发号器获取到值后，本地先递增本地子序列，当超过子序列长度后，再次获取新的发号器序号。

   本地序列在进程中，当系统重启时会丢失，但考虑到 8 位的短链接能够使用的序列号（218340105584896）来说，是可以接受的。

3. **排它锁**

   nodejs 虽然是单进程，但并发场景仍然会多次请求发号器。需要引入排它锁

4. **缓存**

   适当的使用缓存可以提升系统的吞吐量，在系统中，分别使用了一个读缓存和一个写缓存。

   请求获取短链接的接口，对于热点数据将大大提升性能，每次访问将更新缓存失效时间，防止缓存雪崩

   生成短链接的接口，短期内请求两条一样的链接地址时，不查库就可以直接返回

5. **bloomfileter**

   创建短链接成功后，会讲短链接的 key 放入布隆过滤器中，防止当查询不存在的短链接时直接查库，导致缓存穿透
