# 系统设计

## 使用环境

单机部署

低数据量级、低流量简易模型, 不考虑高并发或其他大流量场景

数据读取模型简单，不做DAO层封装，直接SQL查询

## 核心流程设计思路

短链服务模型为单向hash, 即 f(x) => y => y`

且y应当尽量离散化，避免被简单的撞库方式破解

常规y对生成方案有两种

- 使用hash算法，将原始url映射为等长字符串
- 使用ID Generator将原始url生成唯一索引

由于ID Generator最简便的方式为直接使用数据库的自增id，而单机部署的环境下，需要偏复杂的设计才能实现离散化，更适用于集群场景；其他Generator设计则更过于复杂；

因此选用方案1，通过hash算法进行映射得到y

如果撞hash时则通过原始url加固定串的方式重新生成

最后使用62进制8位数将y转化为y`，可容纳 62^8 约200万亿条数据

## 技术选型

框架：TS + Express (题目要求)

HASH：Murmurhash (性能高，散列度高，结果为32位数字易于处理)

存储：SQLite3 (单机文件部署, 可快速启动验证)

单测：Jest

接口集成测试：supertest

日志系统：由于题目未要求，使用console.log并重定向输出即可进行简单问题记录

## 流程图

![img](./workflow.jpg)

## 后续扩展

- 短链的有效期题目没有要求，可以通过增加定时任务，依据创建时间进行清理
- 实用场景下，读取次数会远远大于写入次数，可增加缓存结构(例如Redis + BloomFilter等)，提升读取速度，减少磁盘IO
- 流量较大，单机部署无法承载QPS压力时，可部署多机，使用Nginx进行负载均衡，集群对接独立的Redis服务来满足数据读取
- 流量进一步增加时，超出此方案的设计范畴，需要重新设计系统；