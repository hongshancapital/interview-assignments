
### 环境说明

启动服务： yarn dev

demo页面： http://localhost:3000

长链接换短连接接口：post /long2short {long:\<long>}

短连接跳转长链接接口：get /\<short>

使用了redis来保存数据，key是短链接，value是长链接

redis默认连接本机，修改连接地址在 src/routes/short.ts:6

单测： yarn test
（运行单测时先把服务关掉）

### 潜在的问题

- long2short接口参数错误
    - 校验接口参数存在且满足url格式
- redis连接断开
    - 设置自动重连、保证重连后服务可用、断开时记录日志、如果多次重连不上需要报警
- 短连接冲突
    - 使用分布式锁来解决，redis自带的setNx能够防止重复设值
- 使用随机数生成短链接的缺点：同一个长链接每次来生成短连接都是不一样的，是不是浪费存储空间
    - 如果实际场景确实经常是同一个长链接，可以考虑使用hash算法来生成短连接，不过这也会带来新的问题：短连接只有8位，不同长链接的hash可能冲突，发生冲突时要把冲突的key和value都拿出来比较一下
- 短连接总量不够用
    - 8位短连接总数8的36次方个，要有过期机制，1在调用接口时传入过期时间，2定期清理长时间不使用的链接
- 服务宕机
    - k8s配置存活监听&自动重启，记录日志后续分析原因

