@startuml
actor User as user
participant KOA as koa
participant controller as ctl
participant shortUrlService as service
database Redis as redis
database Mysql as db
== 获取短域名 ==
user -> koa++: /api/short
    koa -> ctl++
        ctl -> service++
            service -> db:queryShortUrl
            alt Mysql中未获取到
                service -> redis:INCR:short_url_serial_number
                service -> service++: 压缩序列号
                    alt 超过8位的长度限制
                        service -> service: 抛出异常
                    end
                deactivate
                service -> db:saveShortUrl
            end
        return
    return
return
== 获取原始域名 ==
user -> koa++: /api/origin
    koa -> ctl++
        ctl -> service++
            service -> db:queryOriginUrl
        return
    return
return
@enduml