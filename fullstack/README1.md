# 背景
短域名服务，简单一点说就是输入完整的长链接，返回唯一标识此链接的短链，从而将链接投放出去到各个三方板块。一方面，过于冗长的长链容易让消费者认为是一种垃圾广告从而不点击而带来流量上的浪费；另一方面，长链携带了过多的消费者用不上而对链路有贡献的数据强行展示出来

# 方案设计
短链总体有两种方案
1. 每次生成短链时，去数据库中查找是否碰撞了已有的短链。如果没有碰撞则继续存储，如果碰撞就重新生成。这种方案最大的缺点是无法适应动辄以亿为单位的生成量。
2. 使用唯一的key来生成值，同时为每个生成的链接设置一个有效期。这样在较长时间内这个链接都是唯一的。

## 本次方案设计
本次方案使用方案2，同时使用如下方案
1. 使用数据库索引ID(数据库主键)作为唯一key，每次使用后自增高。在代码中使用redis的某个值模拟这种效果。
2. 实际线上使用时，使用移动窗口的方式确保早期生成的短链失效

![图片](https://img.alicdn.com/imgextra/i1/O1CN01cb2rOT1WsbEGeoGVM_!!6000000002844-2-tps-864-249.png)

## 总体框架图
![图片](https://img.alicdn.com/imgextra/i2/O1CN01Iun2bq1VqTmPsh1Bw_!!6000000002704-0-tps-422-339.jpg)

# 单侧覆盖率
![图片](https://img.alicdn.com/imgextra/i3/O1CN01fKe3621j4l8C8vsBi_!!6000000004495-0-tps-1184-828.jpg)