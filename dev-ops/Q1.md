# Q1作业

##### 作业用Python完成，在作业中将processid给过滤掉，因为每次程序运行的pid不一样，不易统计，若要统计，将pid这一列重新添加即可。

    #!/usr/bin/env python
    # -*- coding: utf-8 -*-
    
    import re,json
    import requests
    
    #上传位置
    url="https://foo.com/bar"
    headers={"Content-Type":"application/json"}
    
    #文件读取
    f = open("1.txt",'r')
    File = f.readlines()
    f.close()
    
    tmp_dict={}
    
    for line in File:
      #错误日志过滤
      error_line=re.search("Error|error|Failed|failed",line)
      #进程ID注释
      #error_id = re.search('[0-9]{4,5}',line).group()
    
      #拆解日志行
      format_line=re.split(" ",line)
    
      #拼接日志时间，例:0000-0100,....   
      error_hour=int(format_line[2].split(":")[0])
      error_hour_endpot=(error_hour+1)*100
      if error_hour < 10:
        error_time_format="0"+str(error_hour)+"00-0"+str(error_hour_endpot)
        if error_hour == 9:
          error_time_format="0"+str(error_hour)+"00-"+str(error_hour_endpot)
      else:
        error_time_format=str(error_hour)+"00-"+str(error_hour_endpot)
      timeWindow="".join(error_time_format)
      #主机名
      deviceName=format_line[3]
      #格式化错误描述，改为字符串
      description=format_line[6:]
      description=" ".join(description)
    
      #进程名称处理，去掉特殊字符和进程ID,"()[]:"
      processName=re.sub(r'(\)\:|\(|\[\d+\]\):)|(.\d+)','',format_line[5])
      #相同内容进行统计
      tmp_dict[(timeWindow,deviceName,processName,description)]=tmp_dict.get((timeWindow,deviceName,processName,description),0)+1
      #print tmp_dict.items()
    
    #序列化输出和上传
    dict_key=["timeWindow","deviceName","processName","description","numberOfOccurrence"]
    for (timeWindow,deviceName,processName,description),numberOfOccurrence in tmp_dict.items():
      dict_value=[timeWindow,deviceName,processName,description,numberOfOccurrence]
      data=dict(zip(dict_key,dict_value))
      res=requests.post(url=url, headers=headers, data=json.dumps(data))
      print res.status_code

作业用到的内容较少，但是基础知识都有涉及。以前做个两个项目在git上

[GitHub - anliming/Monitor_WEB: 监控公司网站的URL，是否符合预期，如不符发邮件报警](https://github.com/anliming/Monitor_WEB)


