因本人不熟悉ECS Fargate、AWS CDK。只用过简单的ec2、s3、elb...   
故只能简单说下k8s原生解决方案。

## 1. 基础设施及平台

使用kubeadm搭建三套kubernetes平台。   
一套运维平台用于运行Jenkins和Jenkins动态slave、harbor等。   
一套运行业务应用master分支。
一套运行业务应用测试分支。

## 2. 业务应用及发布流程   
一个简单的go helloword   
https://github.com/lixwlixw/helloworld.git

单元测试pipeline:   
开发人员提交代码到某分支并且向master 提交pr.      
github webhook调用Jenkins 启动pipeline.   
Jenkins master在运维集群启动动态Jenkins slave pod(基础镜像安装golang、docker、kubectl、helm等、所需文件通过pvc持久化 提前上传).
git checkout master
git merge xxx
go test.   
go build.   
docker build -t xxx .   
docker push xxx.      
kubectl apply -f xxx.yaml/helm install xxx .   
部署到测试集群
   
   
master部署pipeline:   
当测试环境跑通，且code review之后 合并pr.   
github webhook调用Jenkins 启动部署master pipeline.   
git clone xxx.
go test.   
go build.   
docker build -t xxx .   
docker push xxx.   
kubectl apply -f xxx.yaml/helm install xxx .   
部署到master集群   

## 3. 运营阶段   
使用prometheus监控kubernetes集群      
使用alert manager发告警   
prometheus中可配置告警:   
节点cpu、mem、disk等(node exporter).   
container cpu、mem、disk、status等(cadvisor在kubele中).   
deployment副本状态 是否符合预期(kube-state).   
数据量过大或者有多集群统一存储查询需求可使用thanos   

   
使用efk收集容器日志:   
docker log-deiver需要配置jsonfile落地.      
fluentd ds启动，配置需要收集的pod container日志，output发给es.   
使用es alert配置查询es中业务日志特定字段/状态码发告警.   
